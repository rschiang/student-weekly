{% extends 'dialogs/create_article.html' %}
{% block dialog_id %}edit-article-dialog{% endblock %}
{% block dialog_title %}編輯文章{% endblock %}
{% block dialog_post_url %}{{ url('issues:edit', issue.id) }}{% endblock %}
{% block dialog_hidden_fields %}
    <input type="hidden" name="issue" value="{{ issue.id }}" />
    <input type="hidden" name="column" />
    <input type="hidden" name="article_id" id="edit-article-id-field" />
{% endblock %}
{% block dialog_action_icon %}checkmark{% endblock %}
{% block dialog_action %}儲存{% endblock %}
{% block dialog_scripts %}
<script>
$('.item[data-item-id]').click(function() {
    article_id = $(this).data('item-id');
    $('#edit-article-id-field').val(article_id);
    $.post('{{ url("issues:edit", issue.id) }}', {
        csrfmiddlewaretoken: '{{ csrf_token }}',
        article_id: article_id
    }, function(data, status, xhr) {
        form = $('#edit-article-dialog form');
        for (var key in data)
            form.find('[name="' + key + '"]').val(data[key]);
        console.log(data);

        $('#edit-article-dialog')
        .modal({
            closable: false,
            onApprove: function() {
                $('#edit-article-dialog form').submit();
            }
        })
        .modal('show');
    });
});
</script>
{% endblock %}
